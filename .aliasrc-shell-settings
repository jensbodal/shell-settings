#!/bin/bash
# vi: ft=zsh

alias gs="git status"
alias usingport=__usingport
alias ssh=__usemosh
alias caff=__caff
alias ssh-keygen-secure=__ssh-keygen-secure
alias whatsmyip=__whatsmyip

__usingport() {
  port=`echo "$@" | egrep -o "\d+"`
  dokill=`echo "$@" | egrep -o "\-k"`

  results=`lsof -i -n -P | grep TCP | egrep ":$port \(LISTEN\)"`
  echo "$results" | egrep ":$port"

  pids=`echo $results | awk '{print $2}' ORS=' '`

  if [ ! -z $dokill ]; then
    echo $pids | xargs kill -9
  else
    if [ -z $results ]; then
      len=${#results}
      if [ $len -gt 1 ]; then
        echo "\n> pass -k to kill all matching processes"
      fi
    fi
  fi
}


__usemosh() {
  if ! command -v mosh &> /dev/null
  then
    /usr/bin/ssh "$@"
  else
    mosh "$@"
  fi
}

__caff() {
  if command -v caffeinate &> /dev/null
  then
    caffeinate -disu
  else
    echo "caffeinate not supported"
  fi
}

__ssh-keygen-secure() {
  ssh-keygen -t ed25519 -a 100
}

__whatsmyip() {
  echo "dig +short myip.opendns.com @resolver1.opendns.com"
  dig +short myip.opendns.com @resolver1.opendns.com
  echo "curl ifconfig.co"
  curl ifconfig.co
}
